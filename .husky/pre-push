#!/usr/bin/env sh
. "$(dirname -- "$0")/husky.sh"

# Run Git LFS hook when available; otherwise no-op (silent)
if command -v git-lfs >/dev/null 2>&1; then
  if ! git lfs pre-push "$@"; then
    echo "âŒ Git LFS pre-push failed"
    exit 1
  fi
fi

# Style contract checks
echo "ğŸ” Running style checks..."
if ! pnpm check:styles; then
  echo "âŒ Style checks failed. Run 'pnpm check:styles' to see details."
  echo "   To bypass: git push --no-verify"
  exit 1
fi

# Run lightweight test suite (node + dom tests, fast subset)
# Can be bypassed with: git push --no-verify
echo "ğŸ§ª Running pre-push test checks..."
if ! pnpm test:fast; then
  echo "âŒ Pre-push tests failed. Run 'pnpm test' to see full output."
  echo "   To bypass: git push --no-verify"
  exit 1
fi

# Explicitly exit successfully to ensure git knows the hook completed
exit 0