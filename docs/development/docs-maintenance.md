---
title: "Documentation Maintenance Guide"
description: "Complete guide to documentation maintenance, auto-generation, and troubleshooting for contributors."
last_updated: "2026-01-09"
category: "documentation"
status: "active"
---
# Documentation Maintenance Guide

> **Complete guide to documentation maintenance, auto-generation, validation, and troubleshooting for the Corso platform.**

This guide explains how documentation is maintained, what auto-generates, how to run validation, and what to do when things go wrong.

## ðŸ“‹ Quick Reference

**Essential Commands:**
```bash
# Validate all documentation
pnpm docs:validate

# Check for architecture drift
pnpm check:drift

# Update docs index
pnpm docs:index

# Generate scripts READMEs
pnpm docs:generate:readme -- --all

# Check docs health summary
pnpm docs:doctor
```

## ðŸ”„ Auto-Generated Documentation

### What Auto-Generates

The following documentation files are **automatically generated** and should **not be manually edited**:

1. **`docs/index.ts`** - Main documentation index
   - **Generated by**: `pnpm docs:index`
   - **When**: Automatically updated by pre-commit hook when markdown files are staged
   - **Contains**: Index of all README files in the repository

2. **`scripts/**/README.md`** - Scripts directory READMEs
   - **Generated by**: `pnpm docs:generate:readme -- --all`
   - **When**: Automatically updated by pre-commit hook when scripts are staged
   - **Template**: `docs/_scripts/templates/README.scripts.hbs`
   - **Contains**: Auto-generated table of scripts in each directory

3. **`eslint-plugin-corso/README.md`** - ESLint plugin documentation
   - **Generated by**: `pnpm docs:generate:lint`
   - **When**: Manually or via CI
   - **Contains**: List of all ESLint rules

4. **`scripts/lint/README.md`** - Lint scripts documentation
   - **Generated by**: `pnpm docs:generate:lint`
   - **When**: Manually or via CI
   - **Contains**: List of all lint scripts

5. **`scripts/rules/ast-grep/README.md`** - AST-Grep rules documentation
   - **Generated by**: `pnpm docs:generate:lint`
   - **When**: Manually or via CI
   - **Contains**: List of all AST-Grep rules

### Manual Documentation

The following files are **manually maintained**:

- All files in `docs/**/*.md` (except generated indexes)
- Root `README.md`
- Domain READMEs outside `scripts/` (e.g., `lib/**/README.md`, `components/**/README.md`)

## ðŸ› ï¸ Maintenance Commands

### Validation Commands

**Full Documentation Validation:**
```bash
pnpm docs:validate
```
- Validates links (internal and external)
- Checks document freshness
- Validates frontmatter
- Runs markdown linting
- Validates content (banned patterns, code blocks)

**Content Validation Only:**
```bash
pnpm docs:validate:content
```
- Checks for banned patterns (e.g., `process.env` usage)
- Validates code blocks
- Checks environment variable documentation

**Architecture Drift Check:**
```bash
pnpm check:drift
```
- Detects stale references to removed endpoints/files
- Validates documentation consistency with codebase
- Prevents regressions of known issues

**README Template Validation:**
```bash
pnpm docs:readmes:check
```
- Ensures scripts READMEs don't contain template markers
- Validates README structure

### Generation Commands

**Update Docs Index:**
```bash
pnpm docs:index
```
- Regenerates `docs/index.ts` with current README files
- Automatically runs in pre-commit hook when markdown is staged

**Generate Scripts READMEs:**
```bash
# Generate all scripts READMEs
pnpm docs:generate:readme -- --all

# Incremental mode (only changed scripts)
pnpm docs:generate:readme -- --changed

# Dry run (check what would change)
pnpm docs:generate:readme -- --dry-run
```

**Generate Lint Documentation:**
```bash
pnpm docs:generate:lint
```
- Generates ESLint plugin README
- Generates lint scripts README
- Generates AST-Grep rules README

**Normalize Frontmatter:**
```bash
# Check what would change
pnpm docs:refresh --check

# Apply normalization
pnpm docs:refresh
```

## ðŸ”§ Pre-Commit Hook Behavior

### Automatic Updates

The `.husky/pre-commit-docs` hook automatically updates documentation when:

1. **Only documentation files are staged** (docs-only commit):
   - Updates `docs/index.ts` if markdown files changed
   - Updates `scripts/**/README.md` if scripts changed
   - Stages the updated files automatically

2. **Mixed commit** (docs + code files):
   - Updates `docs/index.ts` if markdown files changed
   - **Skips** scripts README generation (to reduce churn)
   - **Prints warning** with manual commands to run

### When Hooks Are Skipped

If you bypass hooks with `--no-verify` or hooks are disabled:

1. **Run validation manually:**
   ```bash
   pnpm docs:validate
   pnpm check:drift
   ```

2. **Update generated docs:**
   ```bash
   pnpm docs:index
   pnpm docs:generate:readme -- --all
   ```

3. **Commit the generated files:**
   ```bash
   git add docs/index.ts scripts/**/README.md
   git commit -m "docs: update generated documentation"
   ```

### Pre-Commit Hook Warnings

If you see this warning in a mixed commit:
```
âš ï¸  WARNING: Mixed commit detected (docs + code files staged)
   Documentation auto-update is running in limited mode.
   To ensure docs stay in sync, run these commands manually:
   - pnpm docs:index
   - pnpm docs:generate:readme -- --all
   - pnpm docs:validate
```

**Action**: Run the suggested commands before committing to ensure docs stay in sync.

## ðŸ¥ Docs Doctor Command

The `pnpm docs:doctor` command provides a health summary:

```bash
pnpm docs:doctor
```

**Output includes:**
- Total README count
- Stale docs (>90 days old)
- Missing frontmatter fields
- Broken links summary
- Architecture drift check summary

**Usage:**
```bash
# Quick health check
pnpm docs:doctor

# Full validation (includes external link checks)
pnpm docs:doctor --full
```

## ðŸ” Troubleshooting

### Documentation Validation Fails

**Error**: `Documentation content validation failed`

**Fix**:
1. Review the error messages (they show file and line numbers)
2. Fix the issues (missing frontmatter, banned patterns, etc.)
3. Re-run: `pnpm docs:validate:content`

### Architecture Drift Detected

**Error**: `Architecture drift detected`

**Fix**:
1. Review the drift check output
2. Remove or update stale references
3. Re-run: `pnpm check:drift`

### Generated Files Are Out of Sync

**Error**: CI fails with "docs are out of sync"

**Fix**:
1. Run: `pnpm docs:index`
2. Run: `pnpm docs:generate:readme -- --all`
3. Run: `pnpm docs:generate:lint`
4. Commit the changes: `git add docs/index.ts scripts/**/README.md`

### Pre-Commit Hook Fails

**Error**: Pre-commit hook fails on docs validation

**Fix**:
1. Review the error output
2. Fix validation issues
3. Re-run: `pnpm docs:validate`
4. If hooks are blocking, you can temporarily bypass: `git commit --no-verify` (but fix issues before pushing)

### Timestamp-Only Changes

**Issue**: Git shows changes but only `last_updated` changed

**Fix**: This is now prevented automatically. The generator compares normalized content (without timestamps) and skips writes if only the timestamp changed.

## ðŸ“š Related Documentation

- [Documentation Automation](./docs-automation.md) - Detailed automation scripts
- [Documentation Standards](../.cursor/rules/documentation-standards.mdc) - Documentation conventions
- [Development Setup](./setup-guide.md) - Environment setup
- [Coding Standards](./coding-standards.md) - Code quality standards

## ðŸŽ¯ Best Practices

### For Contributors

1. **Before Committing**:
   - Run `pnpm docs:validate` to catch issues early
   - Let pre-commit hooks auto-update generated docs
   - Review generated file changes before committing

2. **When Adding New Scripts**:
   - Scripts READMEs auto-generate, but ensure JSDoc comments are present
   - Use `@fileoverview` or `@description` for script descriptions

3. **When Modifying Documentation**:
   - Update `last_updated` in frontmatter (or let normalization handle it)
   - Ensure frontmatter includes required fields for `docs/` files
   - Run `pnpm docs:validate` before committing

4. **When Hooks Are Skipped**:
   - Always run `pnpm docs:index` and `pnpm docs:generate:readme -- --all` manually
   - Commit generated files in a separate commit
   - Verify with `pnpm docs:validate` before pushing

### For Maintainers

1. **Regular Maintenance**:
   - Run `pnpm docs:doctor` weekly to check health
   - Review stale docs (>90 days) monthly
   - Update frontmatter normalization as needed

2. **CI/CD Integration**:
   - Ensure `docs:check:sync` runs in PR workflows
   - Monitor docs validation failures
   - Review architecture drift reports

## ðŸ”— Quick Links

- **Validation**: `pnpm docs:validate`
- **Drift Check**: `pnpm check:drift`
- **Index Update**: `pnpm docs:index`
- **Scripts READMEs**: `pnpm docs:generate:readme -- --all`
- **Health Check**: `pnpm docs:doctor`

---

_Last updated: 2026-01-09_
