---
rule_id: ai-agent-development-environment
title: AI Agent Development Environment
owners: ["@platform"]
status: active
domains: ["infra","devex"]
enforcement: advise
alwaysApply: true
globs:
  - ".cursor/**"
  - ".agent/**"
  - "scripts/**"
related_rules:
  - documentation-standards
  - code-quality-standards
last_reviewed: "2025-12-15"
summary: Windows-first development environment, workflow standards, and quality gates for Corso applications.
# Reviewed in Dec 2025 - Development workflow and tooling standards current
---
# üöÄ Development Environment & Workflow (Consolidated)

**Comprehensive development environment setup, workflow standards, and TypeScript performance optimization for Corso applications.**

## TL;DR
- **Setup**: Run `pnpm install`, then `pnpm run verify:ai-tools`, then `pnpm run setup:branch` (each sequentially).
- **Development**: Use `pnpm typecheck` for fast feedback on type errors; avoid using `pnpm -s` (silent) so you don't miss output. For UI changes, run `pnpm dev` in a separate terminal to get instant feedback on edits. The `predev` hook automatically cleans ports (3000, 9323) and orphaned processes (>30min old) before starting.
- **Quality gates**: Run `pnpm typecheck ‚Üí pnpm lint ‚Üí pnpm test ‚Üí pnpm validate:cursor-rules` sequentially (don't chain with &&) to ensure all standards pass.
- **Lint performance**: `pnpm lint` uses ESLint cache for faster reruns. Use `pnpm lint:full` for CI-grade validation (rebuilds plugin + lint scripts + lint).
- **Environment**: Use the provided `getEnv()` helper for config (never access `process.env` directly in app code).
- **Windows-safe**: Favor Windows-compatible commands (no Unix-only pipes, use `git --no-pager`, etc.) and run tasks from the repo root without relying on `cd` for navigation.
- **Git Workflow**: Use conventional commits, feature branches, and rebase workflow
- **TypeScript Performance**: Use performance-optimized typecheck for daily development

## Development Setup

### Quickstart (Run Sequentially)
```bash
pnpm install
pnpm run verify:ai-tools
pnpm run setup:branch
pnpm validate:env
pnpm typecheck
pnpm quality:local
(Run each command one-by-one; ensure each passes before moving on.)
```

### VS Code Task Buttons (Status Bar)

This workspace provides clickable task buttons in the VS Code status bar via the **VSCode Task Buttons** extension (`spencerwmiles.vscode-task-buttons`).

**Six Left-Aligned Menus:**
- **üöÄ Setup** ‚Äî Installation, verification, environment checks, branch setup, cleanup
- **‚ö° Dev** ‚Äî Development server and TypeScript watch modes
- **üîç Quality** ‚Äî Typecheck, lint, quality gates, scans
- **üß™ Tests** ‚Äî Test suites, file tests, domain tests, security tests
- **üîß Build** ‚Äî Production builds
- **üìö Docs** ‚Äî OpenAPI generation, documentation

**Configuration:** Task buttons are configured in `.vscode/settings.json` under `VsCodeTaskButtons.tasks`. All tasks reference task labels from `.vscode/tasks.json` and **must match exactly** (emoji, punctuation, spacing).

**Maintenance Warning:** When adding, removing, or renaming tasks in `.vscode/tasks.json`, **agents must update** `.vscode/settings.json` task button configuration to keep them in sync. Broken task references will show "task not found" errors when clicked. See `.vscode/README.md` for full documentation.

### Verifier Checklist
- **Tools installed**: `pnpm run verify:ai-tools` (checks for required CLI tools like gh, rg, etc.).
- **Branch config**: `pnpm run setup:branch` (sets up git hooks, branch naming, etc.).
- **Env vars**: `pnpm validate:env` (ensures all required env vars are set and type-safe).
- **Quality gates**: Run in order ‚Äì `pnpm typecheck`, then `pnpm lint`, then `pnpm test`, then `pnpm validate:cursor-rules`. All must pass locally before committing.

## Windows-first tips

### Git Commands
```bash
# Git: Windows-friendly log (no pager)
git --no-pager log --oneline

# Git: Show latest commit hash without pager
git --no-pager show -s --format=%H HEAD

# Git: View log piped safely on Windows
git --no-pager log --oneline | type
```

### Command Execution
- **Avoid Unix-only operations**: Don't use Unix-specific shell features like `pbcopy` or `cat` in examples; use `type` or native PowerShell equivalents if needed
- **Run commands sequentially**: Execute commands one-by-one rather than chaining with `&&` for easier debugging
- **No `pnpm -s/--silent`**: Avoid silent mode ‚Äì it suppresses output that could contain important warnings
- **Don't rely on `cd` for scripts**: Run commands from the repository root or use subshells/`--prefix` flags to execute in subdirs (avoids path issues on Windows shells)
- **Use forward slashes**: Prefer forward slashes in file paths for consistency across platforms

## Git Workflow & Conventional Commits

### Branching Strategy
- **Feature branches**: `feat/<scope>/<desc>`; fixes: `fix/<scope>/<desc>`
- **Prefer PRs for review**: Pushing to `main` only when all quality gates are green per project conventions.

### Rebase Workflow
```bash
# Sync with main
git fetch origin
git rebase --autosquash --interactive origin/main

# Use fixup commits for follow-ups
git commit --fixup <hash>

# After rebase, validate changes
pnpm typecheck && pnpm lint && pnpm test && pnpm quality:local
```

### Pull Requests
- **Descriptive titles** using Conventional Commits format
- **CI must pass** before review
- **Force push with lease**: `git push --force-with-lease` for updates
- **Bypass pre-push hooks**: `git push --no-verify` (use sparingly, skips tests and style checks)

### Post-merge Cleanup
```bash
git switch main && git pull --ff-only
git branch -D feat/<scope>/<desc>
git remote prune origin
```

### Commit Message Format
```
type(scope): description
```

**Types**: `feat`, `fix`, `docs`, `refactor`, `test`, `chore`, `perf`, `style`, `ci`, `build`, `revert`
**Scopes** (see `commitlint.config.cjs` for authoritative list): `auth`, `dashboard`, `chat`, `components`, `hooks`, `api`, `types`, `stripe`, `openai`, `supabase`, `clickhouse`, `build`, `config`, `styles`, `docs`, `tests`, `infrastructure`, `subscription`, `organization`, `deps`, `db`, `security`
**Subject**: imperative, ‚â§ 50 chars

**Examples**:
- `feat(api): add rate limit to chat generation`
- `fix(stripe): handle missing webhook signature`
- `refactor(api): replace NextResponse.json with http.*`
- `docs(docs): update commit conventions documentation`
- `feat(dashboard): add entity grid feature`

**Breaking changes**: append `!` after the type or scope: `feat!: drop deprecated endpoint`

## TypeScript Performance Optimization

### Available Typecheck Scripts

#### Development (Recommended)
```bash
pnpm typecheck
```
- **Use for**: Daily development, quick feedback
- **Performance**: ~0.5-1 second (optimized cache)
- **Features**: Separate build cache, performance flags

#### Standard Validation
```bash
pnpm typecheck
```
- **Use for**: Pre-commit, CI/CD, full validation
- **Performance**: ~1-2 seconds (varies with cache size)
- **Features**: Complete project validation

#### Quick Check
```bash
pnpm typecheck:fast
```
- **Use for**: Quick development feedback
- **Performance**: ~0.3-0.5 seconds
- **Features**: Minimal validation, may miss some errors

#### Troubleshooting
```bash
pnpm typecheck:clean
```
- **Use for**: Performance issues, cache problems
- **Performance**: ~2-3 seconds (cache rebuild)
- **Features**: Clears build cache, resets incremental state

### Performance Optimizations

#### Compiler Options
- `assumeChangesOnlyAffectDirectDependencies: true` - Faster incremental builds
- `disableSourceOfProjectReferenceRedirect: true` - Reduced project reference overhead
- `tsBuildInfoFile: "./.cache/tsconfig.performance.tsbuildinfo"` - Separate cache location

#### exactOptionalPropertyTypes Best Practices
With `exactOptionalPropertyTypes: true`, object literals must not include `undefined` for keys whose type is plain `string`/`number`/etc.

**Prefer conditional spreads when values may be undefined**:
```ts
const opts = {
  ...(maybeTimeout ? { timeout: maybeTimeout } : undefined),
  retryOn429: true,
};
```

**JSX Component Props**: Use conditional prop spreading to avoid passing `undefined` to optional props:
```tsx
// ‚ùå INCORRECT: Direct prop passing may cause exactOptionalPropertyTypes errors
<PillGroup
  selected={selected} // Error if selected could be undefined
  id={id} // Error if id could be undefined
/>

// ‚úÖ CORRECT: Conditional spreading prevents undefined prop passing
<PillGroup
  {...(selected && { selected })} // Only pass when defined
  {...(id && { id })} // Only pass when defined
/>
```

### Usage Guidelines

| Use Case | Script | Frequency |
|----------|--------|-----------|
| Daily Development | `typecheck` | Every few minutes |
| Pre-commit | Automatic (git hooks) | Before commits (1-3 seconds, optimized) |
| CI/CD | `typecheck` | Every build |
| Troubleshooting | `typecheck:clean` | When experiencing slowdowns |
| Quick Feedback | `typecheck:fast` | During development |

**Note**: Pre-commit hooks (`.husky/pre-commit`) automatically run optimized validation:
- **Performance**: 1-3 seconds (optimized with caching, conditional execution, and parallelization)
- **Optimizations**: Staged-only typecheck, conditional validations, file hash caching
- See `.husky/README.md` for full hook performance details

## Quality gates and validation commands

### Development Workflow
```bash
# Fast feedback during development
pnpm typecheck

# Full validation before commit (run sequentially, not chained)
pnpm typecheck
pnpm lint
pnpm test
pnpm validate:cursor-rules
```

### CI/CD Pipeline
```bash
# Complete validation (CI - run sequentially)
pnpm typecheck
pnpm lint
pnpm test
pnpm validate:cursor-rules
```

### Common Validation Commands
```bash
# Type checking (fast feedback)
pnpm typecheck

# Linting (ESLint-based, uses cache)
pnpm lint

# Testing (unit, integration, components)
pnpm test

# Cursor rules validation
pnpm validate:cursor-rules

# Full quality gates (local development)
pnpm quality:local
```

### Domain-Specific Validation
```bash
# Runtime boundaries
pnpm validate:runtime-boundaries

# OpenAPI RBAC
pnpm openapi:rbac:check

# Environment validation
pnpm validate:env
```

## Development Best Practices

### Do
- **Prefer non-interactive commands**: Use CLI flags or defaults to avoid prompts (e.g. `gh pr create --fill`).
- **Use Windows-friendly Git commands**: e.g. `git --no-pager log` for logs, and `| type` instead of `| cat` if you must pipe on Windows.
- **Run setup scripts in order**: Execute setup steps one after another (as in **TL;DR**). Do not concatenate long sequences with `&&` ‚Äì run each step separately for clarity and easier debugging.
- **Leverage search tools**: Start with broad semantic code searches, then refine with exact symbol searches. Use the repository search (`rg`/`sg`) scoped to relevant folders to gather context in parallel.
- **Make targeted edits**: Apply minimal necessary changes (preserve formatting and import style). Use a small TODO list for multi-step fixes, marking the first task as `in_progress` before editing.
- **Use the PNPM dev server for UI feedback**: If working on frontend or UI-related tasks, keep the development server running (`pnpm dev`) to catch errors or UI regressions immediately as you make changes. The `predev` hook automatically cleans ports and orphaned processes before starting, ensuring clean startup without conflicts.
- **Favor GitHub CLI for context**: Use `gh` commands to retrieve PR details, issues, or to check out branches as needed for context instead of manual web navigation.
- **Post-edit validation**: After making changes, always run the full suite: type-checking, linting, tests, then `pnpm validate:cursor-rules` to catch any rule violations.

## Don‚Äôt  
- **No `pnpm -s/--silent`**: Avoid silent mode ‚Äì it suppresses output that could contain important warnings.  
- **No interactive prompts**: Do not use tools that require user input (everything should be scriptable).  
- **Avoid Unix-only ops**: Don‚Äôt use Unix-specific shell features like `pbcopy` or `cat` in examples; ensure commands work on Windows (use `type` or native PowerShell equivalents if needed).  
- **Don‚Äôt rely on `cd` for scripts**: Do not script directory changes with `cd` as part of multi-step commands ‚Äì instead, run commands from the repository root or use subshells/`--prefix` flags to execute in subdirs. This avoids path issues on Windows shells.  
- **No long command chains**: Break down commands; e.g., prefer running `pnpm build` then `pnpm test` as separate steps rather than `pnpm build && pnpm test` in one line (easier to pinpoint failures).  
- **No watch mode by default**: Unless explicitly needed, avoid watch mode (e.g. `--watch` tests) in automation ‚Äì it should exit when done.
