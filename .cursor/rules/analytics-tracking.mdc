---
rule_id: analytics-tracking
title: Analytics Tracking & User Insights
owners:
  - platform@corso.io
last_reviewed: "2025-10-13"
status: active
domains: [analytics, ux, tracking]
enforcement: warn
related_rules:
  - warehouse-query-hooks
  - code-quality-standards
alwaysApply: true
globs: ["components/**", "lib/shared/analytics/**", "hooks/**"]
summary: Edge-safe analytics tracking with graceful degradation, privacy-first approach, and zero-impact performance.
---

# Analytics Tracking & User Insights

**Secure, edge-safe analytics tracking patterns for user behavior insights and navigation analytics.**

## TL;DR
- **Use shared analytics**: Import from `@/lib/shared/analytics/track` for edge-safe tracking
- **Graceful degradation**: Analytics failures never break user experience
- **Privacy-first**: Respect user consent and data minimization
- **Performance optimized**: Zero-impact tracking with proper error boundaries
- **Type safety**: Full TypeScript support for tracking events

## Purpose
Provide edge-safe analytics tracking with graceful degradation, privacy-first approach, and zero-impact performance for user behavior insights.

## Core Tracking Patterns

### ✅ CORRECT: Shared Analytics Usage

```typescript
// Edge-safe, client-only analytics tracking
import { trackNavClick } from '@/lib/shared/analytics/track';

const handleClick = (event) => {
  trackNavClick("Features", "/#features");
  // ... navigation logic
};
```

### ❌ INCORRECT: Direct Analytics Calls

```typescript
// NEVER do this - breaks edge compatibility
if (typeof window !== 'undefined') {
  window.analytics?.track('nav_click', data);
}
```

## Rules

- **MUST** use shared analytics from `@/lib/shared/analytics/track`
- **MUST** ensure graceful degradation (analytics failures never break UX)
- **MUST** respect user consent preferences
- **MUST** minimize tracked data (no PII, no IP addresses)
- **MUST** use error boundaries (never throw from tracking)
- **SHOULD** use debouncing for rapid interactions
- **SHOULD** lazy-load analytics when possible

## Provider Integration

For Segment and Google Analytics 4 integration patterns, see [extended documentation](../../docs/ai/rules/analytics-tracking.md#provider-integration-patterns).

## Event Taxonomy

For navigation events, user interactions, and error tracking patterns, see [extended documentation](../../docs/ai/rules/analytics-tracking.md#event-taxonomy).

## Privacy & Compliance

For consent management and data minimization patterns, see [extended documentation](../../docs/ai/rules/analytics-tracking.md#privacy--compliance).

## Performance Optimization

For debounced tracking and lazy loading patterns, see [extended documentation](../../docs/ai/rules/analytics-tracking.md#performance-optimization).

## Testing Patterns

For mock analytics setup and test examples, see [extended documentation](../../docs/ai/rules/analytics-tracking.md#testing-patterns).

## Error Handling & Monitoring

For graceful degradation and health monitoring patterns, see [extended documentation](../../docs/ai/rules/analytics-tracking.md#error-handling--monitoring).

## Migration from Legacy Patterns

For migration guides from direct analytics to shared patterns, see [extended documentation](../../docs/ai/rules/analytics-tracking.md#migration-from-legacy-patterns).

## Enforcement

### ESLint Rules (Planned)
The following ESLint rules are planned for future implementation:
- `@corso/no-direct-analytics`: Prevent direct analytics usage
- `@corso/analytics-error-boundary`: Enforce error boundaries
- `@corso/analytics-privacy-check`: Enforce privacy compliance

**Note**: These rules are not yet implemented in `eslint-plugin-corso`. Enforcement is currently handled via code review and shared analytics utilities.

For AST-Grep rules and ESLint configuration, see [extended documentation](../../docs/ai/rules/analytics-tracking.md#enforcement---ast-grep-rules).

## Quality Gates

### Production Readiness
- ✅ Edge Compatible: No Node.js dependencies in client code
- ✅ Error Resilient: Graceful degradation on tracking failures
- ✅ Privacy Compliant: Consent-aware, data-minimized tracking
- ✅ Performance Optimized: Zero blocking, lazy-loaded when possible
- ✅ Test Coverage: Unit tests for all tracking functions

## Windows-first tips

See the canonical guidance in
[ai-agent-development-environment.mdc](mdc:.cursor/rules/ai-agent-development-environment.mdc#windows-first-tips).

## Related Rules

- `cursor/warehouse-query-hooks` - Data fetching patterns
- `cursor/security-standards` - Secure API patterns (consolidated)
- `cursor/code-quality-standards` - General code quality
