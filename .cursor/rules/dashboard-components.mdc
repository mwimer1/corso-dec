---
rule_id: dashboard-components
title: Dashboard Components â€” Chat & Tables (Consolidated)
owners:
  - platform@corso.io
last_reviewed: "2025-01-29"
status: active
domains: [components, dashboard, chat, tables]
enforcement: warn
related_rules:
  - component-design-system
  - runtime-boundaries
alwaysApply: false
globs: ["components/dashboard/**/*.tsx"]
summary: Dashboard component development patterns for chat interfaces and data tables with proper runtime boundaries.
---

# Dashboard Components â€” Chat & Tables (Consolidated)

**Comprehensive guide to dashboard component development, including chat interfaces and data tables with proper boundaries and guardrails.**

## TL;DR
- **Client/Server Boundaries**: Respect runtime boundaries; no server-only imports in client components
- **Public Barrels**: Use `@/components/dashboard` (client) and `@/components/dashboard/server` (server)
- **Styling**: Token/variant-based only; no raw colors
- **Props**: Keep additions additive and optional (backward compatible)
- **Accessibility**: ARIA labels and semantic roles required
- **Validation**: Type-safe filters and SQL parameterization

## ðŸŽ¯ Component Scope

### Chat Components
- `components/dashboard/chat/chat-dock.tsx`
- `components/dashboard/chat/chat-window.tsx`
- **API Endpoint**: `POST /api/v1/dashboard/chat/process` (streaming NDJSON chat processing)

### Table Components
- `components/dashboard/entities/**/*.tsx` - Entity grid components
- `lib/entities/**/*.ts` - Entity service layer

## ðŸ›¡ï¸ Guardrails & Boundaries

### Client/Server Separation
```typescript
// âœ… CORRECT: Client components use public barrels
import { DashboardTable } from '@/components/dashboard';
import { useDashboardData } from '@/lib/dashboard';

// âœ… CORRECT: Server components use service layer
import { EntityListPage } from '@/components/dashboard/entities';
import { getEntityPage } from '@/lib/entities/pages';

// âŒ INCORRECT: Server-only imports in client components
// import { getClickhouse } from '@/lib/integrations/clickhouse/server';
```

### Import Boundaries
- **Client**: `@/components/dashboard`, `@/lib/dashboard`
- **Server**: `@/components/dashboard/entities`, `@/lib/entities`
- **No self-barrels**: Within `components/dashboard/**`, prefer relative/leaf imports rather than importing back through the dashboard barrel

### Styling Requirements
- Use only token/variant-based styling; no raw colors
- Follow design system variant patterns
- Maintain consistent theming with route groups

## ðŸ’¬ Chat Components

### ChatWindow Props (Additive)
```typescript
interface ChatWindowProps {
  // Optional props for backward compatibility
  showHeader?: boolean;           // Shows compact header bar
  headerTitle?: string;           // Header title text
  onToggleContext?: () => void;   // Callback for context toggle
  onSuggestionClick?: (label: string) => void; // Fired when suggestion chip clicked
  showTypingLine?: boolean;       // Subtle typing line below the list
}
```

### ChatDock Props (Additive)
```typescript
interface ChatDockProps {
  // Same optional props as ChatWindow
  showHeader?: boolean;
  headerTitle?: string;
  onToggleContext?: () => void;
  onSuggestionClick?: (label: string) => void;
  showTypingLine?: boolean;
}
```

### Chat Accessibility
```typescript
// âœ… CORRECT: Proper ARIA implementation
<ChatDock 
  role="complementary" 
  aria-label="Data assistant"
>
  <input 
    aria-label="Chat message input"
    placeholder="Ask about your data..."
  />
  <button aria-label="Send message">Send</button>
</ChatDock>
```

## ðŸ“Š Table Components

### Filter Mapping
```typescript
// âœ… CORRECT: Type-safe filter mapping
interface FilterMapping {
  numberRange: { op: 'between', value: [number, number] };
  dateRange: { op: 'between', value: [Date, Date] };
  boolean: { op: 'bool', value: boolean };
  // Others default to 'eq'
  [key: string]: { op: string, value: any };
}

// âŒ INCORRECT: SQL string interpolation
// const sql = `SELECT * FROM table WHERE status = '${status}'`;

// âœ… CORRECT: Parameterized queries
const sql = 'SELECT * FROM table WHERE status = ?';
const params = [status];
```

### Column Renderers
```typescript
// âœ… CORRECT: Client-side renderer attachment
const columns = [
  {
    key: 'status',
    title: 'Status',
    meta: {
      renderer: (value: string) => <StatusBadge status={value} />
    }
  }
];

// âŒ INCORRECT: Passing functions from server to client
// const serverFunction = () => { /* server logic */ };
```

### Entity Data Helpers
```typescript
// âœ… CORRECT: Server-side entity helpers
import { getEntityPage } from '@/lib/entities/pages';

export async function EntityPage({ entity }: { entity: string }) {
  const data = await getEntityPage(entity, { page: { index: 0, size: 50 } });
  return <EntityListPage data={data} />;
}
```

## ðŸ§ª Testing & Validation

### Component Testing
```typescript
// Test chat components
import { render, screen } from '@testing-library/react';
import { ChatWindow } from '@/components/dashboard/chat/chat-window';

test('chat window renders with optional props', () => {
  render(
    <ChatWindow 
      showHeader={true}
      headerTitle="Test Chat"
      onToggleContext={jest.fn()}
    />
  );
  
  expect(screen.getByText('Test Chat')).toBeInTheDocument();
});
```

### Table Testing
```typescript
// Test table components
import { DashboardTable } from '@/components/dashboard';

test('table respects filter boundaries', () => {
  const filters = {
    status: { op: 'eq', value: 'active' },
    dateRange: { op: 'between', value: [new Date(), new Date()] }
  };
  
  render(<DashboardTable filters={filters} />);
  // Test filter application
});
```

### Validation Commands
```bash
# Before commit validation
pnpm typecheck
pnpm lint
pnpm vitest run tests/components --run
pnpm validate:cursor-rules
```

## ðŸ“š Documentation Requirements

### Component Documentation
- Update `components/README.md` entries for ChatDock and ChatWindow to reflect props
- Keep a brief style guide in `docs/design/chat-style-guide.md`
- Document filter mapping patterns for tables
- Include accessibility guidelines

### API Documentation
- Document chat processing endpoint: `POST /api/v1/dashboard/chat/process`
- Include streaming NDJSON format specifications
- Document entity data helper functions

## Enforcement

### AST-Grep Rules
```yaml
# Detect server imports in client components
rule: |
  import $X from '@/lib/integrations/clickhouse/server$Y'
  where:
    regex: "^components/dashboard/"

# Detect SQL string interpolation
rule: |
  const $SQL = `SELECT.*\$\{.*\}`
  where:
    regex: "^components/dashboard/|^lib/dashboard/"
```

### ESLint Integration
```javascript
// .eslintrc.mjs
{
  rules: {
    '@corso/dashboard-boundaries': 'error',
    '@corso/no-sql-interpolation': 'error',
    '@corso/dashboard-accessibility': 'error'
  }
}
```

### Quality gates

See the canonical command set in
[ai-agent-development-environment.mdc](mdc:.cursor/rules/ai-agent-development-environment.mdc#quality-gates-and-validation-commands).

### Domain-Specific Dashboard Commands
- **Component Tests**: `pnpm test:components`
- **Boundary Validation**: `pnpm validate:runtime-boundaries`
- **Dashboard Specific**: `pnpm validate:dashboard-components`

## Windows-first tips

See the canonical guidance in
[ai-agent-development-environment.mdc](mdc:.cursor/rules/ai-agent-development-environment.mdc#windows-first-tips).

## Related Rules

- `cursor/component-design-system` - Component architecture and design system
- `cursor/runtime-boundaries` - Server/Edge import safety
